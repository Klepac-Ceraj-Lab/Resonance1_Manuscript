# Extended Methods

## Exclusion criteria
These included: in utero alcohol, cigarette or illicit substance exposure; Preterm (<37wks gestation) birth; small for gestational age or less than 1500g; fetal ultrasound abnormalities; preeclampsia, high blood pressure, or gestational diabetes; 5 minute APGAR scores <8; NCU admission; neurological disorder (e.g., head injury resulting in loss of consciousness, epilepsy); and psychiatric or learning disorder in the infant, parents or siblings (including maternal depression requiring medication in the year prior to pregnancy)
MRI preprocessing
T1-weighted magnetization-prepared rapid acquisition gradient echo anatomical data were acquired with an isotropic voxel volume of 1.2x1.2x1.2mm3, resampled to 0.9 x 0,9 x 0.9mm3 Sequence specific parameters were: TE=6.9ms; TR=16ms; inversion preparation time=950ms; flip angle=15 degrees; BW=450Hz/Pixel. The acquisition matrix and field of view were varied according to child head size in order to maintain a constant voxel volume and spatial resolution across all ages30. Using a multistep registration procedure31, a series of study- and age-specific anatomical T1-weighted templates were created corresponding to 6, 9, 12, 15, 18, 21, 24, and 27 month ages. At least 10 boys and 10 girls were included in each template. An overall study template was then created from these age templates, which was aligned to the MNI152 template32.  Each child’s anatomical T1-weighted image was transformed into MNI space by first aligning to their age-appropriate template and then applying the pre-computed transformation to MNI space, with the calculated individual forward and reverse transformations saved and used for the volumetric analysis described below. All template creation and image alignment was performed using a 3D nonlinear approach (ANTS33) with cross-correlation and mutual information cost functions.  

## MRI processing
MR data processing included motion correction and averaging34 of volumetric T1 weighted images, removal of non-brain tissue using a hybrid watershed/surface deformation procedure35, automated Talairach transformation, segmentation of the subcortical white matter and deep gray matter volumetric structures36,37intensity normalization38, tessellation of the gray matter white matter boundary, automated topology correction39,40, and surface deformation following intensity gradients to optimally place the gray/white and gray/cerebrospinal fluid borders at the location where the greatest shift in intensity defines the transition to the other tissue class41,41,42 (Dale and Sereno, 1993). Once the cortical models were complete, a number of deformable procedures can be performed for further data processing and analysis including surface inflation43, registration to a spherical atlas which is based on individual cortical folding patterns to match cortical geometry across subjects44, parcellation of the cerebral cortex into units with respect to gyral and sulcal structure45,46, and creation of a variety of surface based data including maps of curvature and sulcal depth. This method uses both intensity and continuity information from the entire three dimensional MR volume in segmentation and deformation procedures to produce representations of cortical thickness, calculated as the closest distance from the gray/white boundary to the gray/CSF boundary at each vertex on the tessellated surface42. The maps are created using spatial intensity gradients across tissue classes and are therefore not simply reliant on absolute signal intensity. The maps produced are not restricted to the voxel resolution of the original data thus are capable of detecting submillimeter differences between groups. Procedures for the measurement of cortical thickness have been validated against histological analysis47 and manual measurements48,49. Freesurfer morphometric procedures have been demonstrated to show good test-retest reliability across scanner manufacturers and across field strengths50,51.

## Brain region definition
Neocortex: anterior cingulate, middle frontal, cuneus, entorhinal, fusiform, inferior parietal, inferior temporal, isthmus cingulate, lateral occipital, lateral orbitofrontal, lingual, medial orbitofrontal, middle temporal, parahippocampal, paracentral, pars opercularis, pars orbitalis, pars triangularis, pericalcarine, postcentral, posterior cingulate, precentral, precuneus, rostral anterior cingulate, rostral middle frontal, superior frontal, superior parietal, superior temporal, supramarginal, frontal pole, temporal pole, transverse temporal
Limbic: entorhinal, lateral orbitofrontal, medial orbitofrontal, rostral anterior cingulate, thalamus, hippocampus, amygdala
Subcortex: thalamus, caudate, putamen, pallidum, hippocampus, amygdala, insula, operculum
Cerebellum: cerebellum cortex
Note: some regions were ambiguous and included in measures of multiple regions. The sum of voxel volumes for all subregions were normalized to total brain volume before subsequent analyses.

## Computational and Statistical analysis

### Shotgun metagenomics processing
Metagenomic sequence reads were analyzed using the bioBakery27 family of tools with default parameters. First, raw sequence data were run through KneadData (v0.7.1) was used to trim and filter raw sequence reads and to separate human reads from bacterial sequences. Second, reads that passed quality control were taxonomically profiled using MetaPhlAn2 (v2.7.7), generating taxon abundance tables. Species-level rows were collected and normalized using total sum scaling (TSS).
Taxonomic profiles and QC-passed reads were functionally profiled using HUMAnN2 (v0.11.1) to generate gene families functional profiles (UniRef90). Gene families were regrouped into Pfam and KO using the `humann2_regroup_tables` script. All functional profiles were TSS normalized using the `humann2_renorm_tables` script. UNMAPPED and UNGROUPED rows were then removed prior to downstream analyses. For “accessory” genes analyses, samples were grouped by age (kids under 1 year old, kids over 2 years old, and pregnant women), and gene families that were present in over 90% of samples within a given age group were excluded.

### Principal coordinates analysis (PCoA)
Pairwise Bray-Curtis dissimilarities were calculated for all samples using the Distances.jl package. PCoAs were performed by fitting the resulting distance matrices using classical multidimensional scaling (MDS) from the MultivariateStats.jl package. Percent variance explained for each axis is the relative proportion of the eigenvalue for that axis’ among all positive eigenvalues.

### PERMANOVA
PERMANOVA fitting was performed using the `adonis` function from the vegan R package. Pairwise distance matrices were computed as described above. Each PERMANOVA was computed separately, calculating the percent variance that may be explained by a given variable, and many use different subsets of subjects, so results may not add to 100%.
In each analysis, only samples for which data was available were used. “Subject” used all samples (n=802). “Subject Type” refers to pregnant woman vs. child, and included only the first sample contributed by each individual (n=561). “Age” (corrected for gestational age, n=310), “child gender“ (n=310),  “birth type” (cesarean vs vaginal, n=287), “breastfeeding” (exclusive breastfeeding, exclusive formula, or mixed, n=71), “BMI” (calculated as (weight in lbs) / (height in inches)2 * 703, n = xx),  “mother SES” (composite HHS score including education level and occupation, n=171), and “cognitive function” (n=263) included the first sample for all children for which data were available. “2+ age” and “2+ subject type” were performed as above, but only included children over 2 years old.
Due to the strong effect of age on Brain data from high-resolution MRI (neocortical, limbic, subcortical, cerebellar, n=141), we used multivariate PERMANOVA for these measures, where variation due to age was assessed first, and the reported value is the % variarance remaining attributable to each brain region.

### Feature set enrichment analysis (FSEA)
Potentially neuroactive microbial gene sets were acquired from supplementary dataset 1 from Valles-Colmer et al.15 KOs from this dataset were mapped to UniRef90s using the mapping files included with HUMAnN2 to generate gene sets. The Pearson correlations for each measure (cognitive function score or brain region) and each UniRef90 gene family found in at least 4 subjects were calculated. As expected, correlations between all gene families and each measure were approximately normally distributed. The Mann-Whitney U test assesses whether a randomly selected value from one population will be greater or less than a randomly selected value from a different population. We performed the Mann-Whitney U test (implemented in the HypothesisTests.jl package) on the correlations of each gene family in a neuroactive gene set against the correlations of all gene families not found in the gene set. P values after BH FDR correction (q value) were used to assess significance.

### Extra references
Neuro.bib
